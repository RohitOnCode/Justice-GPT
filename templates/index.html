<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>JusticeGPT — IPC Legal Copilot</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet"/>
</head>
<body class="bg-light d-flex flex-column vh-100">
  <nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand mb-0 h1">⚖️ JusticeGPT — IPC Legal Copilot</span>
  </nav>

  <main class="container my-3 flex-grow-1 d-flex flex-column" id="chat-box"></main>

  <!-- Thinking / Loading -->
  <div class="text-center my-2" id="loading" style="display:none;">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Thinking...</span>
    </div>
    <div class="small text-muted mt-1">Thinking…</div>
  </div>

  <footer class="container pb-3">
    <form id="chat-form" class="input-group">
      <input id="msg" type="text" class="form-control" placeholder="Ask about IPC sections… e.g., 'What is Section 420 of IPC?'" autocomplete="off"/>
      <button class="btn btn-primary">Send</button>
    </form>
  </footer>

<script>
const form = document.getElementById("chat-form");
const input = document.getElementById("msg");
const box = document.getElementById("chat-box");
const loading = document.getElementById("loading");

function addBubble(text, who) {
  const div = document.createElement("div");
  div.className = "alert " + (who === "user" ? "alert-primary ms-auto" : "alert-secondary me-auto");
  div.innerText = text;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const text = input.value.trim();
  if (!text) return;
  addBubble(text, "user");
  input.value = "";
  loading.style.display = "block";
  try {
    const res = await fetch("/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text })
    });
    const data = await res.json();
    addBubble(data.answer, "bot");
  } catch (err) {
    addBubble("Sorry, something went wrong.", "bot");
  } finally {
    loading.style.display = "none";
  }
});
</script>
</body>
</html>
